\section{Disturbance Observers and Reaction Force Estimation}

In addition to the NMPC framework, disturbance observerâ€“based techniques are employed to enhance robustness and to estimate interaction forces without relying on additional physical sensors. Disturbance observers (DOBs) are used to compensate for unmodeled dynamics, coupling effects, and external perturbations, while reaction disturbance observers enable the estimation of load-dependent forces and torques arising from physical interaction with the environment.

\subsection{Fork Disturbance Observer (FDOB)}


\begin{figure}[t]
    \centering
    \includegraphics[width=0.5\linewidth]{DO-arm.png}
    \caption{Block diagram of the fork disturbance observer (FDOB) implementation.}
    \label{fig:DO-arm}
\end{figure}


To compensate for unmodeled dynamics and external effects acting on the fork joint, a disturbance observer is introduced. The observer estimates the total disturbance torque affecting the fork angle, including dynamic coupling with the remaining subsystems, parametric uncertainties, and external torques.

The rotational dynamics associated with the fork angle are expressed as
\begin{equation}
m_{41}\ddot{\theta}_w + m_{42}\ddot{\theta}_p + m_{43}\ddot{d}_m + m_{44}\ddot{\theta}_a + h_4 + g_4
=
n_a\tau_a - T_{la}.
\end{equation}

By introducing a nominal inertia parameter $m_{n44}$, the fork dynamics are rewritten in nominal form as
\begin{equation}
m_{n44}\ddot{\theta}_a^{res}
=
n_a\tau_a^{ref}
-
\tilde{\tau}_{a}^{dist},
\end{equation}
where $\tilde{\tau}_{a}^{dist}$ denotes the lumped disturbance torque. This term can be expanded as
\begin{equation}
\tilde{\tau}_{a}^{dist}
=
m_{41}\ddot{\theta}_w^{res}
+
m_{42}\ddot{\theta}_p^{res}
+
m_{43}\ddot{d}_m^{res}
+
(m_{44} - m_{n44})\ddot{\theta}_a^{res}
+
h_4 + g_4 + T_{la}.
\end{equation}

The disturbance torque is estimated using a pseudo-differentiation method applied to the measured fork angular velocity. The resulting FDOB estimate is given by
\begin{equation}
\hat{\tau}_{a}^{dist}
=
\frac{g_a}{s + g_a}
\left(
n_a\tau_a^{ref}
+
g_a m_{n44}\dot{\theta}_a^{res}
\right)
-
g_a m_{n44}\dot{\theta}_a^{res}.
\end{equation}

The block diagram of the FDOB implementation within the control architecture is shown in Fig.~6.3.1.

\subsection{Fork Angle Control}

The fork angle is regulated using a PD controller augmented with the disturbance estimate provided by the FDOB. The resulting control law is defined as
\begin{equation}
\tau_a^{ref}
=
K_{pa}(\theta_a^{cmd} - \theta_a^{res})
+
K_{da}(\dot{\theta}_a^{cmd} - \dot{\theta}_a^{res})
+
\hat{\tau}_{a}^{dist}.
\end{equation}

The complete FDOB--PD control architecture is illustrated in Fig.~6.4.1.

\subsection{Fork Reaction Torque Observer (FRTOB)}


\begin{figure}[t]
    \centering
    \includegraphics[width=0.5\linewidth]{RDO-arm.png}
    \caption{Block diagram of the fork reaction torque observer (FRTOB) implementation.}
    \label{fig:RDO-arm}
\end{figure}

Beyond disturbance compensation, a reaction torque observer is formulated to estimate the torque generated by an external load acting on the fork. The load-dependent torque is modeled as
\begin{equation}
T_{la}
=
\tilde{\tau}_a^{ext}
+
\tilde{\tau}_a^{fric}.
\end{equation}

By isolating gravity and friction effects from the total disturbance, the reaction torque is expressed as
\begin{equation}
\tilde{\tau}_a^{reac}
=
m_{41}\ddot{\theta}_w^{res}
+
m_{42}\ddot{\theta}_p^{res}
+
m_{43}\ddot{d}_m^{res}
+
(m_{44} - m_{n44})\ddot{\theta}_a^{res}
+
h_4
+
\tilde{\tau}_a^{ext}.
\end{equation}

The nominal fork dynamics can then be written as
\begin{equation}
m_{n44}\ddot{\theta}_a^{res}
=
n_a\tau_a^{ref}
-
g_4
-
\tilde{\tau}_a^{fric}
-
\tilde{\tau}_a^{reac}.
\end{equation}

The reaction torque is estimated using
\begin{equation}
\hat{\tau}_a^{reac}
=
\frac{g_r}{s + g_r}
\left(
n_a\tau_a^{ref}
+
g_r m_{n44}\dot{\theta}_a^{res}
-
g_4
-
\tilde{\tau}_a^{fric}
\right)
-
g_r m_{n44}\dot{\theta}_a^{res}.
\end{equation}

The FRTOB implementation is depicted in Fig.~6.5.1. The estimated reaction torque is related to the load-dependent kinematic term $t_l$ as
\begin{equation}
t_l
=
-\frac{\hat{\tau}_a^{reac}}{g m_l}.
\end{equation}

\subsection{Lift Disturbance Observer (LDOB)}

\begin{figure}[t]
    \centering
    \includegraphics[width=0.5\linewidth]{DO-lift.png}
    \caption{Block diagram of the lift disturbance observer (LDOB) implementation.}
    \label{fig:DO-lift}
\end{figure}

An analogous disturbance observer is designed for the lift subsystem to estimate the total disturbance force acting on the vertical actuator. The lift dynamics are described by
\begin{equation}
m_{31}\ddot{\theta}_w + m_{32}\ddot{\theta}_p + m_{33}\ddot{d}_m + m_{34}\ddot{\theta}_a + h_3 + g_3
=
f_m - F_{lm}.
\end{equation}

Introducing a nominal mass parameter $m_{n33}$, the lift dynamics are rewritten as
\begin{equation}
m_{n33}\ddot{d}_m^{res}
=
f_m^{ref}
-
\tilde{f}_m^{dist},
\end{equation}
where the disturbance force is defined as
\begin{equation}
\tilde{f}_m^{dist}
=
m_{31}\ddot{\theta}_w^{res}
+
m_{32}\ddot{\theta}_p^{res}
+
(m_{33} - m_{n33})\ddot{d}_m^{res}
+
m_{34}\ddot{\theta}_a^{res}
+
h_3 + g_3 + F_{lm}.
\end{equation}

The disturbance force estimate is obtained using a pseudo-differentiation method,
\begin{equation}
\hat{f}_m^{dist}
=
\frac{g_m}{s + g_m}
\left(
f_m^{ref}
+
g_m m_{n33}\dot{d}_m^{res}
\right)
-
g_m m_{n33}\dot{d}_m^{res}.
\end{equation}

The LDOB implementation is shown in Fig.~6.6.1.

\subsection{Lift Displacement Control}

The lift displacement is regulated using a PD controller augmented with the disturbance force estimate,
\begin{equation}
f_m^{ref}
=
K_{pm}(d_m^{cmd} - d_m^{res})
+
K_{dm}(\dot{d}_m^{cmd} - \dot{d}_m^{res})
+
\hat{f}_m^{dist}.
\end{equation}

The complete LDOB--PD control architecture is illustrated in Fig.~6.7.1.

\subsection{Lift Reaction Force Observer (LRFOB)}

\begin{figure}[t]
    \centering
    \includegraphics[width=0.5\linewidth]{RDO-lift.png}
    \caption{Block diagram of the lift reaction force observer (LRFOB) implementation.}
    \label{fig:RDO-lift}
\end{figure}

The external load force acting on the lift mechanism is modeled as
\begin{equation}
F_{lm}
=
\tilde{f}_m^{ext}
+
\tilde{f}_m^{fric}.
\end{equation}

By excluding gravity and friction contributions from the disturbance formulation, the reaction force estimate is obtained as
\begin{equation}
\hat{f}_m^{reac}
=
\frac{g_r}{s + g_r}
\left(
f_m^{ref}
+
g_r m_{n33}\dot{d}_m^{res}
-
g_3
-
\tilde{f}_m^{fric}
\right)
-
g_r m_{n33}\dot{d}_m^{res}.
\end{equation}

The LRFOB block diagram is shown in Fig.~6.8.1. The estimated reaction force is related to the load mass parameter used in the kinematic model as
\begin{equation}
m_l
=
\frac{\hat{f}_m^{reac}}{g \cos(\theta_p)}.
\end{equation}
